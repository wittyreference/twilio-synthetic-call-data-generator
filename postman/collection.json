{
  "info": {
    "name": "Twilio Synthetic Call Data Generator",
    "description": "Postman collection for generating synthetic call data using Twilio Programmable Voice API with AI-powered customer and agent personas",
    "version": "1.0.0",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Pre-request script: Select random customer and agent personas",
          "",
          "// Load customer personas (embedded from customers.json)",
          "const customers = [",
          "  pm.environment.get('customers') ? JSON.parse(pm.environment.get('customers')) : []",
          "].flat();",
          "",
          "// Load agent personas (embedded from agents.json)",
          "const agents = [",
          "  pm.environment.get('agents') ? JSON.parse(pm.environment.get('agents')) : []",
          "].flat();",
          "",
          "// Select random customer",
          "if (customers.length > 0) {",
          "  const randomCustomer = customers[Math.floor(Math.random() * customers.length)];",
          "  pm.environment.set('customerName', randomCustomer.CustomerName);",
          "  pm.environment.set('customerPhone', randomCustomer.PhoneNumber);",
          "  pm.environment.set('customerIssue', randomCustomer.Issue);",
          "  pm.environment.set('customerPrompt', randomCustomer.Prompt);",
          "  console.log('Selected customer:', randomCustomer.CustomerName);",
          "}",
          "",
          "// Select random agent",
          "if (agents.length > 0) {",
          "  const randomAgent = agents[Math.floor(Math.random() * agents.length)];",
          "  pm.environment.set('agentName', randomAgent.AgentName);",
          "  pm.environment.set('agentIntroduction', randomAgent.ScriptedIntroduction);",
          "  pm.environment.set('agentCharacteristics', randomAgent.Characteristics);",
          "  console.log('Selected agent:', randomAgent.AgentName);",
          "}"
        ]
      }
    }
  ],
  "item": [
    {
      "name": "Create Conference",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status code is 201 Created', function () {",
              "    pm.response.to.have.status(201);",
              "});",
              "",
              "pm.test('Response has conference SID', function () {",
              "    const jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('conferenceSid');",
              "    pm.expect(jsonData.conferenceSid).to.match(/^CF[a-f0-9]{32}$/);",
              "    ",
              "    // Save for subsequent requests",
              "    pm.environment.set('conferenceSid', jsonData.conferenceSid);",
              "    pm.environment.set('conferenceId', jsonData.conferenceId);",
              "});",
              "",
              "pm.test('Response includes customer and agent participants', function () {",
              "    const jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('customer');",
              "    pm.expect(jsonData).to.have.property('agent');",
              "    pm.expect(jsonData.customer).to.have.property('participantSid');",
              "    pm.expect(jsonData.agent).to.have.property('participantSid');",
              "});",
              "",
              "pm.test('Timer is scheduled', function () {",
              "    const jsonData = pm.response.json();",
              "    pm.expect(jsonData.timerScheduled).to.be.true;",
              "    pm.expect(jsonData.timerDuration).to.equal(300);",
              "});"
            ]
          }
        }
      ],
      "request": {
        "auth": {
          "type": "basic",
          "basic": [
            {
              "key": "username",
              "value": "{{TWILIO_ACCOUNT_SID}}",
              "type": "string"
            },
            {
              "key": "password",
              "value": "{{TWILIO_AUTH_TOKEN}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/x-www-form-urlencoded"
          }
        ],
        "body": {
          "mode": "urlencoded",
          "urlencoded": [
            {
              "key": "agentPhoneNumber",
              "value": "{{AGENT_PHONE_NUMBER}}",
              "type": "text"
            },
            {
              "key": "strategy",
              "value": "random",
              "type": "text"
            }
          ]
        },
        "url": {
          "raw": "{{BASE_URL}}/create-conference",
          "host": ["{{BASE_URL}}"],
          "path": ["create-conference"]
        },
        "description": "Creates a new Twilio conference with randomly selected customer and agent personas"
      }
    },
    {
      "name": "Get Conference Status",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status code is 200 OK', function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Response has conference details', function () {",
              "    const jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('sid');",
              "    pm.expect(jsonData).to.have.property('status');",
              "    pm.expect(jsonData).to.have.property('friendlyName');",
              "});"
            ]
          }
        }
      ],
      "request": {
        "auth": {
          "type": "basic",
          "basic": [
            {
              "key": "username",
              "value": "{{TWILIO_ACCOUNT_SID}}",
              "type": "string"
            },
            {
              "key": "password",
              "value": "{{TWILIO_AUTH_TOKEN}}",
              "type": "string"
            }
          ]
        },
        "method": "GET",
        "header": [],
        "url": {
          "raw": "https://api.twilio.com/2010-04-01/Accounts/{{TWILIO_ACCOUNT_SID}}/Conferences/{{conferenceSid}}.json",
          "protocol": "https",
          "host": ["api", "twilio", "com"],
          "path": ["2010-04-01", "Accounts", "{{TWILIO_ACCOUNT_SID}}", "Conferences", "{{conferenceSid}}.json"]
        },
        "description": "Retrieves the status of a conference created in the previous request"
      }
    },
    {
      "name": "Terminate Conference",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status code is 200 OK', function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Conference was terminated', function () {",
              "    const jsonData = pm.response.json();",
              "    pm.expect(jsonData.success).to.be.true;",
              "    pm.expect(jsonData.action).to.equal('terminated');",
              "});"
            ]
          }
        }
      ],
      "request": {
        "auth": {
          "type": "basic",
          "basic": [
            {
              "key": "username",
              "value": "{{TWILIO_ACCOUNT_SID}}",
              "type": "string"
            },
            {
              "key": "password",
              "value": "{{TWILIO_AUTH_TOKEN}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/x-www-form-urlencoded"
          }
        ],
        "body": {
          "mode": "urlencoded",
          "urlencoded": [
            {
              "key": "ConferenceSid",
              "value": "{{conferenceSid}}",
              "type": "text"
            }
          ]
        },
        "url": {
          "raw": "{{BASE_URL}}/conference-timer",
          "host": ["{{BASE_URL}}"],
          "path": ["conference-timer"]
        },
        "description": "Terminates the conference by updating its status to completed"
      }
    }
  ]
}
